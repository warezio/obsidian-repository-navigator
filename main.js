var E=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var L=Object.prototype.hasOwnProperty;var R=(a,i)=>{for(var e in i)E(a,e,{get:i[e],enumerable:!0})},V=(a,i,e,t)=>{if(i&&typeof i=="object"||typeof i=="function")for(let s of C(i))!L.call(a,s)&&s!==e&&E(a,s,{get:()=>i[s],enumerable:!(t=A(i,s))||t.enumerable});return a};var O=a=>V(E({},"__esModule",{value:!0}),a);var _={};R(_,{default:()=>y});module.exports=O(_);var k=require("obsidian");var f="repo-nav-tree-view",T={showHiddenDirs:!0,fileExtensions:".md",excludedDirs:"node_modules,.git",sortOrder:"folders-first",collapseOnStartup:!1},v="folder-tree";var g=require("obsidian"),w=class extends g.PluginSettingTab{constructor(i,e){super(i,e),this.plugin=e}display(){let{containerEl:i}=this;i.empty(),new g.Setting(i).setName("Show hidden directories").setDesc("Include dot-prefixed directories (e.g., .github, .obsidian) in the tree. Hidden folders are shown by default.").addToggle(e=>e.setValue(this.plugin.settings.showHiddenDirs).onChange(async t=>{this.plugin.settings.showHiddenDirs=t,await this.plugin.saveSettings()})),new g.Setting(i).setName("File extensions").setDesc("Comma-separated list of extensions to include (e.g., .md,.mdx).").addText(e=>e.setPlaceholder(".md").setValue(this.plugin.settings.fileExtensions).onChange(async t=>{this.plugin.settings.fileExtensions=t,await this.plugin.saveSettings()})),new g.Setting(i).setName("Excluded directories").setDesc("Comma-separated directory names to always exclude.").addText(e=>e.setPlaceholder("node_modules,.git").setValue(this.plugin.settings.excludedDirs).onChange(async t=>{this.plugin.settings.excludedDirs=t,await this.plugin.saveSettings()})),new g.Setting(i).setName("Sort order").setDesc("How to sort files and directories in the tree.").addDropdown(e=>e.addOption("folders-first","Folders first").addOption("az","Alphabetical (A-Z)").addOption("za","Alphabetical (Z-A)").setValue(this.plugin.settings.sortOrder).onChange(async t=>{this.plugin.settings.sortOrder=t,await this.plugin.saveSettings()})),new g.Setting(i).setName("Collapse on startup").setDesc("Start with all directories collapsed when opening the view.").addToggle(e=>e.setValue(this.plugin.settings.collapseOnStartup).onChange(async t=>{this.plugin.settings.collapseOnStartup=t,await this.plugin.saveSettings()}))}};var d=require("obsidian");function F(a){return a.trim()?a.split(",").map(i=>i.trim()).filter(i=>i.length>0).map(i=>i.startsWith(".")?i:"."+i):[]}function I(a){return a.trim()?new Set(a.split(",").map(i=>i.trim()).filter(i=>i.length>0)):new Set}function S(a,i){if(a.type!=="file"){for(let e of a.children)S(e,i);switch(i){case"folders-first":a.children.sort((e,t)=>e.type!==t.type?e.type==="directory"?-1:1:e.name.localeCompare(t.name));break;case"az":a.children.sort((e,t)=>e.name.localeCompare(t.name));break;case"za":a.children.sort((e,t)=>t.name.localeCompare(e.name));break}}}async function b(a,i,e,t,s){let n=[];try{let l=await a.list(i);for(let c of l.files)e.some(r=>c.endsWith(r))&&n.push(c);for(let c of l.folders){let r=c.split("/").pop()||"";if(t.has(r)||!s&&r.startsWith("."))continue;let o=await b(a,c,e,t,s);n.push(...o)}}catch(l){}return n}async function D(a,i){let e=F(i.fileExtensions),t=I(i.excludedDirs),s={name:"/",path:"",type:"directory",children:[]};if(e.length===0)return s;let n=new Map;n.set("",s);let l;i.showHiddenDirs?l=await b(a.vault.adapter,"",e,t,!0):l=a.vault.getFiles().filter(r=>e.some(o=>r.path.endsWith(o))).map(r=>r.path);for(let c of l){let r=c.split("/"),o=r.pop(),p="",h=!1;for(let u of r){let x=p;if(p=p?p+"/"+u:u,t.has(u)){h=!0;break}if(!i.showHiddenDirs&&u.startsWith(".")){h=!0;break}if(!n.has(p)){let N={name:u,path:p,type:"directory",children:[]};n.set(p,N),n.get(x).children.push(N)}}if(!h){let x={name:o.replace(/\.[^.]+$/,""),path:c,type:"file",children:[]};n.get(p).children.push(x)}}return S(s,i.sortOrder),s}var P=class{constructor(i){this.document=i;this.menuEl=null;this.closeCallback=null;this.setupGlobalClickListener()}show(i,e,t){this.hide();let s=this.document.createElement("div");s.addClass("repo-nav-context-menu");for(let p of t){let h=s.createDiv({cls:"repo-nav-context-menu-item"});h.createSpan({cls:"repo-nav-context-menu-icon"}),(0,d.setIcon)(h,p.icon),h.createSpan({text:p.label}),h.addEventListener("click",u=>{u.stopPropagation(),p.action(),this.hide()})}this.document.body.appendChild(s);let n=150,c=t.length*36+8,r=i,o=e;r+n>this.document.body.clientWidth&&(r=this.document.body.clientWidth-n-8),o+c>this.document.body.clientHeight&&(o=this.document.body.clientHeight-c-8),s.style.left=`${r}px`,s.style.top=`${o}px`,this.menuEl=s}hide(){this.menuEl&&(this.menuEl.remove(),this.menuEl=null)}setupGlobalClickListener(){this.document.addEventListener("click",()=>{this.hide()})}},m=class extends d.ItemView{constructor(e,t){super(e);this.treeData=null;this.expandedPaths=new Set;this.debounceTimer=null;this.plugin=t,this.contextMenu=new P(this.containerEl.ownerDocument)}getViewType(){return f}getDisplayText(){return"Repository Navigator"}getIcon(){return v}async onOpen(){if(this.expandedPaths=new Set,this.treeData=await D(this.app,this.plugin.settings),!this.plugin.settings.collapseOnStartup&&this.treeData)for(let e of this.treeData.children)e.type==="directory"&&this.expandedPaths.add(e.path);this.renderView(),this.registerEvent(this.app.vault.on("create",()=>this.debouncedRefresh())),this.registerEvent(this.app.vault.on("delete",()=>this.debouncedRefresh())),this.registerEvent(this.app.vault.on("rename",()=>this.debouncedRefresh())),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>this.updateActiveFile()))}async onClose(){this.debounceTimer!==null&&clearTimeout(this.debounceTimer)}expandAll(e){let t=this.findNode(this.treeData,e);if(t){let s=this.collectDescendantPaths(t);for(let n of s)this.expandedPaths.add(n);this.renderView()}}collapseAll(e){let t=this.findNode(this.treeData,e);if(t){let s=this.collectDescendantPaths(t);for(let n of s)this.expandedPaths.delete(n);this.renderView()}}findNode(e,t){if(!e)return null;if(e.path===t)return e;for(let s of e.children){let n=this.findNode(s,t);if(n)return n}return null}collectDescendantPaths(e){let t=[];if(e.type==="directory"){t.push(e.path);for(let s of e.children)t.push(...this.collectDescendantPaths(s))}return t}renderView(){this.contentEl.empty();let e=this.contentEl.createDiv({cls:"repo-nav-header"}),t=this.collectAllDirPaths(this.treeData),s=t.size>0&&t.size===this.expandedPaths.size,n=e.createEl("button",{attr:{"aria-label":s?"Collapse all":"Expand all"}});(0,d.setIcon)(n,s?"chevrons-down-up":"chevrons-up-down"),n.addEventListener("click",()=>{if(s)this.expandedPaths.clear();else for(let r of t)this.expandedPaths.add(r);this.renderView()});let l=e.createEl("button",{attr:{"aria-label":"Refresh"}});(0,d.setIcon)(l,"refresh-cw"),l.addEventListener("click",()=>{this.refreshTree()});let c=this.contentEl.createDiv({cls:"repo-nav-tree"});if(!this.treeData||this.treeData.children.length===0){c.createDiv({cls:"repo-nav-empty",text:"No Markdown files found in this vault."});return}for(let r of this.treeData.children)this.renderNode(c,r,0)}renderNode(e,t,s){let n=e.createDiv({cls:"repo-nav-node"});if(n.style.paddingLeft=`${s*16}px`,n.dataset.path=t.path,t.type==="directory"){n.addClass("repo-nav-dir");let l=this.expandedPaths.has(t.path),c=n.createSpan({cls:"repo-nav-chevron"});(0,d.setIcon)(c,l?"chevron-down":"chevron-right");let r=n.createSpan({cls:"repo-nav-icon"});if((0,d.setIcon)(r,"folder"),n.createSpan({cls:"repo-nav-name",text:t.name}),n.addEventListener("click",o=>{o.stopPropagation(),this.expandedPaths.has(t.path)?this.expandedPaths.delete(t.path):this.expandedPaths.add(t.path),this.renderView()}),n.addEventListener("contextmenu",o=>{o.preventDefault(),o.stopPropagation(),this.contextMenu.show(o.clientX,o.clientY,[{label:"Expand All",icon:"chevrons-up-down",action:()=>this.expandAll(t.path)},{label:"Collapse All",icon:"chevrons-down-up",action:()=>this.collapseAll(t.path)}])}),l){let o=e.createDiv({cls:"repo-nav-children"});for(let p of t.children)this.renderNode(o,p,s+1)}}else{n.addClass("repo-nav-file");let l=this.app.workspace.getActiveFile();l&&l.path===t.path&&n.addClass("repo-nav-active");let c=n.createSpan({cls:"repo-nav-icon"});(0,d.setIcon)(c,"file-text"),n.createSpan({cls:"repo-nav-name",text:t.name}),n.addEventListener("click",async r=>{r.stopPropagation();let o=this.app.vault.getAbstractFileByPath(t.path);o instanceof d.TFile&&(r.metaKey||r.ctrlKey?await this.app.workspace.getLeaf("tab").openFile(o):await this.app.workspace.getLeaf(!1).openFile(o))})}}collectAllDirPaths(e){let t=new Set;if(!e)return t;let s=n=>{n.type==="directory"&&n.path&&t.add(n.path);for(let l of n.children)s(l)};return s(e),t}debouncedRefresh(){this.debounceTimer!==null&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.refreshTree()},300)}updateActiveFile(){let e=this.app.workspace.getActiveFile();if(this.containerEl.querySelectorAll(".repo-nav-file").forEach(s=>s.removeClass("repo-nav-active")),e){let s=this.containerEl.querySelector(`.repo-nav-file[data-path="${CSS.escape(e.path)}"]`);s&&s.addClass("repo-nav-active")}}async refreshTree(){this.treeData=await D(this.app,this.plugin.settings),this.renderView()}};var y=class extends k.Plugin{constructor(){super(...arguments);this.settings=T}async onload(){await this.loadSettings(),this.registerView(f,e=>new m(e,this)),this.addRibbonIcon(v,"Repository Navigator",()=>{this.activateView()}),this.addCommand({id:"open-repo-nav",name:"Open tree view",callback:()=>{this.activateView()}}),this.addSettingTab(new w(this.app,this)),this.app.workspace.onLayoutReady(()=>{this.activateView()})}onunload(){this.app.workspace.detachLeavesOfType(f)}async activateView(){let e=this.app.workspace.getLeavesOfType(f);if(e.length>0){this.app.workspace.revealLeaf(e[0]);return}let t=this.app.workspace.getLeftLeaf(!1);t&&(await t.setViewState({type:f,active:!0}),this.app.workspace.revealLeaf(t))}async loadSettings(){let e=await this.loadData();this.settings=Object.assign({},T,e)}async saveSettings(){await this.saveData(this.settings);let e=this.app.workspace.getLeavesOfType(f);for(let t of e){let s=t.view;s instanceof m&&await s.refreshTree()}}};
