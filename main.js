var D=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var V=Object.getOwnPropertyNames;var R=Object.prototype.hasOwnProperty;var I=(n,s)=>{for(var e in s)D(n,e,{get:s[e],enumerable:!0})},O=(n,s,e,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of V(s))!R.call(n,i)&&i!==e&&D(n,i,{get:()=>s[i],enumerable:!(t=A(s,i))||t.enumerable});return n};var _=n=>O(D({},"__esModule",{value:!0}),n);var W={};I(W,{default:()=>P});module.exports=_(W);var L=require("obsidian");var u="repo-nav-tree-view",v="repo-nav-hidden-file",T={showHiddenDirs:!0,fileExtensions:".md",excludedDirs:"node_modules,.git",sortOrder:"folders-first",collapseOnStartup:!1},w="folder-tree";var g=require("obsidian"),y=class extends g.PluginSettingTab{constructor(s,e){super(s,e),this.plugin=e}display(){let{containerEl:s}=this;s.empty(),new g.Setting(s).setName("Show hidden directories").setDesc("Include dot-prefixed directories (e.g., .github, .obsidian) in the tree. Hidden folders are shown by default.").addToggle(e=>e.setValue(this.plugin.settings.showHiddenDirs).onChange(async t=>{this.plugin.settings.showHiddenDirs=t,await this.plugin.saveSettings()})),new g.Setting(s).setName("File extensions").setDesc("Comma-separated list of extensions to include (e.g., .md,.mdx).").addText(e=>e.setPlaceholder(".md").setValue(this.plugin.settings.fileExtensions).onChange(async t=>{this.plugin.settings.fileExtensions=t,await this.plugin.saveSettings()})),new g.Setting(s).setName("Excluded directories").setDesc("Comma-separated directory names to always exclude.").addText(e=>e.setPlaceholder("node_modules,.git").setValue(this.plugin.settings.excludedDirs).onChange(async t=>{this.plugin.settings.excludedDirs=t,await this.plugin.saveSettings()})),new g.Setting(s).setName("Sort order").setDesc("How to sort files and directories in the tree.").addDropdown(e=>e.addOption("folders-first","Folders first").addOption("az","Alphabetical (A-Z)").addOption("za","Alphabetical (Z-A)").setValue(this.plugin.settings.sortOrder).onChange(async t=>{this.plugin.settings.sortOrder=t,await this.plugin.saveSettings()})),new g.Setting(s).setName("Collapse on startup").setDesc("Start with all directories collapsed when opening the view.").addToggle(e=>e.setValue(this.plugin.settings.collapseOnStartup).onChange(async t=>{this.plugin.settings.collapseOnStartup=t,await this.plugin.saveSettings()}))}};var d=require("obsidian");function F(n){return n.trim()?n.split(",").map(s=>s.trim()).filter(s=>s.length>0).map(s=>s.startsWith(".")?s:"."+s):[]}function H(n){return n.trim()?new Set(n.split(",").map(s=>s.trim()).filter(s=>s.length>0)):new Set}function k(n,s){if(n.type!=="file"){for(let e of n.children)k(e,s);switch(s){case"folders-first":n.children.sort((e,t)=>e.type!==t.type?e.type==="directory"?-1:1:e.name.localeCompare(t.name));break;case"az":n.children.sort((e,t)=>e.name.localeCompare(t.name));break;case"za":n.children.sort((e,t)=>t.name.localeCompare(e.name));break}}}async function C(n,s,e,t,i){let a=[];try{let l=await n.list(s);for(let c of l.files)e.some(r=>c.endsWith(r))&&a.push(c);for(let c of l.folders){let r=c.split("/").pop()||"";if(t.has(r)||!i&&r.startsWith("."))continue;let o=await C(n,c,e,t,i);a.push(...o)}}catch(l){}return a}async function S(n,s){let e=F(s.fileExtensions),t=H(s.excludedDirs),i={name:"/",path:"",type:"directory",children:[]};if(e.length===0)return i;let a=new Map;a.set("",i);let l;s.showHiddenDirs?l=await C(n.vault.adapter,"",e,t,!0):l=n.vault.getFiles().filter(r=>e.some(o=>r.path.endsWith(o))).map(r=>r.path);for(let c of l){let r=c.split("/"),o=r.pop(),p="",h=!1;for(let f of r){let x=p;if(p=p?p+"/"+f:f,t.has(f)){h=!0;break}if(!s.showHiddenDirs&&f.startsWith(".")){h=!0;break}if(!a.has(p)){let N={name:f,path:p,type:"directory",children:[]};a.set(p,N),a.get(x).children.push(N)}}if(!h){let x={name:o.replace(/\.[^.]+$/,""),path:c,type:"file",children:[]};a.get(p).children.push(x)}}return k(i,s.sortOrder),i}var b=class{constructor(s){this.document=s;this.menuEl=null;this.closeCallback=null;this.setupGlobalClickListener()}show(s,e,t){this.hide();let i=this.document.createElement("div");i.addClass("repo-nav-context-menu");for(let p of t){let h=i.createDiv({cls:"repo-nav-context-menu-item"});h.createSpan({cls:"repo-nav-context-menu-icon"}),(0,d.setIcon)(h,p.icon),h.createSpan({text:p.label}),h.addEventListener("click",f=>{f.stopPropagation(),p.action(),this.hide()})}this.document.body.appendChild(i);let a=150,c=t.length*36+8,r=s,o=e;r+a>this.document.body.clientWidth&&(r=this.document.body.clientWidth-a-8),o+c>this.document.body.clientHeight&&(o=this.document.body.clientHeight-c-8),i.style.left=`${r}px`,i.style.top=`${o}px`,this.menuEl=i}hide(){this.menuEl&&(this.menuEl.remove(),this.menuEl=null)}setupGlobalClickListener(){this.document.addEventListener("click",()=>{this.hide()})}},m=class extends d.ItemView{constructor(e,t){super(e);this.treeData=null;this.expandedPaths=new Set;this.debounceTimer=null;this.plugin=t,this.contextMenu=new b(this.containerEl.ownerDocument)}getViewType(){return u}getDisplayText(){return"Repository Navigator"}getIcon(){return w}async onOpen(){if(this.expandedPaths=new Set,this.treeData=await S(this.app,this.plugin.settings),!this.plugin.settings.collapseOnStartup&&this.treeData)for(let e of this.treeData.children)e.type==="directory"&&this.expandedPaths.add(e.path);this.renderView(),this.registerEvent(this.app.vault.on("create",()=>this.debouncedRefresh())),this.registerEvent(this.app.vault.on("delete",()=>this.debouncedRefresh())),this.registerEvent(this.app.vault.on("rename",()=>this.debouncedRefresh())),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>this.updateActiveFile()))}async onClose(){this.debounceTimer!==null&&clearTimeout(this.debounceTimer)}expandAll(e){let t=this.findNode(this.treeData,e);if(t){let i=this.collectDescendantPaths(t);for(let a of i)this.expandedPaths.add(a);this.renderView()}}collapseAll(e){let t=this.findNode(this.treeData,e);if(t){let i=this.collectDescendantPaths(t);for(let a of i)this.expandedPaths.delete(a);this.renderView()}}findNode(e,t){if(!e)return null;if(e.path===t)return e;for(let i of e.children){let a=this.findNode(i,t);if(a)return a}return null}collectDescendantPaths(e){let t=[];if(e.type==="directory"){t.push(e.path);for(let i of e.children)t.push(...this.collectDescendantPaths(i))}return t}renderView(){this.contentEl.empty();let e=this.contentEl.createDiv({cls:"repo-nav-header"}),t=this.collectAllDirPaths(this.treeData),i=t.size>0&&t.size===this.expandedPaths.size,a=e.createEl("button",{attr:{"aria-label":i?"Collapse all":"Expand all"}});(0,d.setIcon)(a,i?"chevrons-down-up":"chevrons-up-down"),a.addEventListener("click",()=>{if(i)this.expandedPaths.clear();else for(let r of t)this.expandedPaths.add(r);this.renderView()});let l=e.createEl("button",{attr:{"aria-label":"Refresh"}});(0,d.setIcon)(l,"refresh-cw"),l.addEventListener("click",()=>{this.refreshTree()});let c=this.contentEl.createDiv({cls:"repo-nav-tree"});if(!this.treeData||this.treeData.children.length===0){c.createDiv({cls:"repo-nav-empty",text:"No Markdown files found in this vault."});return}for(let r of this.treeData.children)this.renderNode(c,r,0)}renderNode(e,t,i){let a=e.createDiv({cls:"repo-nav-node"});if(a.style.paddingLeft=`${i*16}px`,a.dataset.path=t.path,t.type==="directory"){a.addClass("repo-nav-dir");let l=this.expandedPaths.has(t.path),c=a.createSpan({cls:"repo-nav-chevron"});(0,d.setIcon)(c,l?"chevron-down":"chevron-right");let r=a.createSpan({cls:"repo-nav-icon"});if((0,d.setIcon)(r,"folder"),a.createSpan({cls:"repo-nav-name",text:t.name}),a.addEventListener("click",o=>{o.stopPropagation(),this.expandedPaths.has(t.path)?this.expandedPaths.delete(t.path):this.expandedPaths.add(t.path),this.renderView()}),a.addEventListener("contextmenu",o=>{o.preventDefault(),o.stopPropagation(),this.contextMenu.show(o.clientX,o.clientY,[{label:"Expand All",icon:"chevrons-up-down",action:()=>this.expandAll(t.path)},{label:"Collapse All",icon:"chevrons-down-up",action:()=>this.collapseAll(t.path)}])}),l){let o=e.createDiv({cls:"repo-nav-children"});for(let p of t.children)this.renderNode(o,p,i+1)}}else{a.addClass("repo-nav-file");let l=this.app.workspace.getActiveFile();l&&l.path===t.path&&a.addClass("repo-nav-active");let c=a.createSpan({cls:"repo-nav-icon"});(0,d.setIcon)(c,"file-text"),a.createSpan({cls:"repo-nav-name",text:t.name}),a.addEventListener("click",async r=>{r.stopPropagation();let o=r.metaKey||r.ctrlKey,p=this.app.vault.getAbstractFileByPath(t.path);p instanceof d.TFile?o?await this.app.workspace.getLeaf("tab").openFile(p):await this.app.workspace.getLeaf(!1).openFile(p):await this.openHiddenFile(t.path,o)})}}collectAllDirPaths(e){let t=new Set;if(!e)return t;let i=a=>{a.type==="directory"&&a.path&&t.add(a.path);for(let l of a.children)i(l)};return i(e),t}debouncedRefresh(){this.debounceTimer!==null&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.refreshTree()},300)}updateActiveFile(){let e=this.app.workspace.getActiveFile();if(this.containerEl.querySelectorAll(".repo-nav-file").forEach(i=>i.removeClass("repo-nav-active")),e){let i=this.containerEl.querySelector(`.repo-nav-file[data-path="${CSS.escape(e.path)}"]`);i&&i.addClass("repo-nav-active")}}async refreshTree(){this.treeData=await S(this.app,this.plugin.settings),this.renderView()}async openHiddenFile(e,t){let i=this.app.workspace.getLeaf(t?"tab":!1);await i.setViewState({type:v,state:{filePath:e}}),this.app.workspace.revealLeaf(i)}},E=class extends d.ItemView{constructor(){super(...arguments);this.filePath=""}getViewType(){return v}getDisplayText(){return this.filePath?(this.filePath.split("/").pop()||this.filePath).replace(/\.[^.]+$/,""):"Hidden File"}getIcon(){return"file-text"}async setState(e,t){e.filePath&&(this.filePath=e.filePath,await this.renderContent()),await super.setState(e,t)}getState(){return{filePath:this.filePath}}async onOpen(){this.filePath&&await this.renderContent()}async renderContent(){this.contentEl.empty(),this.contentEl.createDiv({cls:"repo-nav-hidden-file-path"}).createSpan({text:this.filePath});let t=this.contentEl.createDiv({cls:"repo-nav-hidden-file-content markdown-rendered"});try{let i=await this.app.vault.adapter.read(this.filePath);await d.MarkdownRenderer.render(this.app,i,t,this.filePath,this)}catch(i){t.createDiv({cls:"repo-nav-empty",text:"Unable to read file."})}}};var P=class extends L.Plugin{constructor(){super(...arguments);this.settings=T}async onload(){await this.loadSettings(),this.registerView(u,e=>new m(e,this)),this.registerView(v,e=>new E(e)),this.addRibbonIcon(w,"Repository Navigator",()=>{this.activateView()}),this.addCommand({id:"open-repo-nav",name:"Open tree view",callback:()=>{this.activateView()}}),this.addSettingTab(new y(this.app,this)),this.app.workspace.onLayoutReady(()=>{this.activateView()})}onunload(){this.app.workspace.detachLeavesOfType(u)}async activateView(){let e=this.app.workspace.getLeavesOfType(u);if(e.length>0){this.app.workspace.revealLeaf(e[0]);return}let t=this.app.workspace.getLeftLeaf(!1);t&&(await t.setViewState({type:u,active:!0}),this.app.workspace.revealLeaf(t))}async loadSettings(){let e=await this.loadData();this.settings=Object.assign({},T,e)}async saveSettings(){await this.saveData(this.settings);let e=this.app.workspace.getLeavesOfType(u);for(let t of e){let i=t.view;i instanceof m&&await i.refreshTree()}}};
